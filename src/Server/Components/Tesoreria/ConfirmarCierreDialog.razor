@using MudBlazor
@using Server.Models

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <div class="d-flex gap-3 align-start">
                <MudIcon Icon="@Icons.Material.Filled.WarningAmber" Size="Size.Large" Color="Color.Error" />
                <div>
                    <MudText Typo="Typo.h6" Class="font-weight-700">⚠️ CONFIRMAR CIERRE CONTABLE</MudText>
                    <MudText Typo="Typo.body2" Class="text-muted mt-2">
                        Está a punto de cerrar <strong>@ObtenerNombreMes(Mes) de @Ano</strong>.
                    </MudText>
                </div>
            </div>

            <MudAlert Severity="Severity.Error" Dense="true">
                <MudText Typo="Typo.caption" Class="font-weight-600">
                    Esta acción es IRREVERSIBLE. Una vez confirmada, no podrá editar recibos ni egresos de este período.
                </MudText>
            </MudAlert>

            <MudDivider />

            <div>
                <MudText Typo="Typo.body2" Class="font-weight-600 mb-2">
                    Para proceder, escriba la palabra <strong style="color: #d32f2f;">CONFIRMAR</strong>:
                </MudText>
                <MudTextField @bind-Value="textoConfirmacion" 
                             Label="Escriba: CONFIRMAR" 
                             Variant="Variant.Outlined"
                             FullWidth
                             Placeholder="CONFIRMAR"
                             InputType="InputType.Text"
                             Clearable="true" />
            </div>

            <MudText Typo="Typo.caption" Class="text-muted">
                El cierre será registrado por: <strong>@UsuarioActual</strong>
            </MudText>
        </MudStack>
    </DialogContent>

    <DialogActions>
        <MudButton Variant="Variant.Text" OnClick="Cancel">Cancelar</MudButton>
        <MudButton Variant="Variant.Filled" 
                   Color="Color.Error"
                   Disabled="@(!PuedeConfirmar)"
                   OnClick="Confirmar"
                   StartIcon="@Icons.Material.Filled.Lock">
            CERRAR PERÍODO
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public int Ano { get; set; }

    [Parameter]
    public int Mes { get; set; }

    [Parameter]
    public string UsuarioActual { get; set; } = "Sistema";

    private string textoConfirmacion = "";

    private bool PuedeConfirmar => textoConfirmacion == "CONFIRMAR";

    private void Cancel() => MudDialog?.Cancel();

    private void Confirmar()
    {
        MudDialog?.Close(DialogResult.Ok(true));
    }

    private string ObtenerNombreMes(int mes) => mes switch
    {
        1 => "Enero",
        2 => "Febrero",
        3 => "Marzo",
        4 => "Abril",
        5 => "Mayo",
        6 => "Junio",
        7 => "Julio",
        8 => "Agosto",
        9 => "Septiembre",
        10 => "Octubre",
        11 => "Noviembre",
        12 => "Diciembre",
        _ => mes.ToString()
    };
}
