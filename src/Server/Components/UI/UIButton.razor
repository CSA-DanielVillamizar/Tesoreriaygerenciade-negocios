@using Microsoft.AspNetCore.Components.Web

<button @attributes="AdditionalAttributes"
    class="@CssClass"
    aria-disabled="@(Disabled || Loading)"
    aria-busy="@Loading"
    type="@Type"
    @onclick="OnClick"
    disabled="@(Disabled || Loading ? string.Empty : null)">
    @if (Loading)
    {
        <span class="animate-spin mr-2"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"/></svg></span>
    }
    @ChildContent
</button>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public string Variant { get; set; } = "primary";
    [Parameter] public string Size { get; set; } = "md";
    [Parameter] public bool Loading { get; set; }
    /// <summary>
    /// Indica si el botón debe estar deshabilitado. Cuando es false NO se renderiza el atributo HTML "disabled".
    /// Evita el problema anterior donde se emitía disabled="False" y el navegador lo interpretaba igualmente como deshabilitado.
    /// </summary>
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string? Class { get; set; }
    /// <summary>
    /// Tipo de botón: button (por defecto), submit o reset.
    /// </summary>
    [Parameter] public string Type { get; set; } = "button";
    /// <summary>
    /// Evento de clic del botón.
    /// </summary>
    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }

    [Parameter(CaptureUnmatchedValues = true)] public IReadOnlyDictionary<string, object>? AdditionalAttributes { get; set; }

    private string CssClass => $"inline-flex items-center font-semibold transition duration-150 ease-out focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-60 {GetVariant()} {GetSize()} {Class}";
    // NOTA: La clase 'disabled:opacity-60' aplica sólo cuando el atributo disabled se renderiza. Con la lógica condicional anterior
    // ya no se mostrará si Disabled == false y Loading == false.
    private string GetVariant() => Variant switch
    {
        "primary" => "rounded-lg px-4 py-2 text-white bg-primary hover:bg-primary-600",
        "secondary" => "rounded-lg px-4 py-2 text-primary bg-white border border-primary hover:bg-primary/10",
        "ghost" => "px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800",
        "danger" => "rounded-lg px-4 py-2 text-white bg-danger hover:bg-danger/80",
        _ => ""
    };
    private string GetSize() => Size switch
    {
        "sm" => "text-sm px-3 py-1",
        "md" => "text-base px-4 py-2",
        "lg" => "text-lg px-6 py-3",
        _ => ""
    };
}
